# RedmineUndevGit

## Описание

Плагин добавляет в редмайн 2 новых возможности:

  - cобственный git-адаптер;
  - хуки;

### UndevGit

Плагин содержит собственный git-адаптер на базе библиотеки grit (её же использует github),
который помимо стандартных вещей, добавляет следующую функциональность:

  - в настройках репозитория можно указывать не только путь к локальному
    каталогу с исходниками, но и ссылку на удалённый репозиторий (git://, https://);

  - репозиторий автоматически обновляется при вызове fetch_changesets;

  - для каждого ченджсета сохраняются ветки;

  - "ключевые слова" (closes, fix и т.п.) обрабатываются глобально для всех
    проектов, т.е. любой коммит может изменять любой тикет редмайна, а не только
    тикеты своего проекта;

  - возможность отключения применения хуков при подключении репозитория

**Особенности**:

В отличии от стандартного адаптера, в UndevGit, чтобы сослаться на коммит, не
нужно использовать ключевые слова (ref keywords). Достаточно просто в комментарии
упомянуть #номер_тикета.

### Хуки

Плагин добавляет такую сущность, как "хук". При помощи хуков возможно гибко
настраивать поведение (выставление статуса, изменение процента готовности)
ключевых слов в зависимости от ветки / проекта, к которым принадлежит ченджсет.
Хуки бывают 3 видов: глобальные, локальные для проекта и локальные для
репозитория.

## Ограничения

 1. Только git, только UTF-8, только Мытищи^W^W только русская и английская локаль.
 2. Не поддерживаются таймлоги.

## Установка

 1. Скопировать каталог с плагином в plugins
 2. bundle exec rake redmine:plugins:migrate
 3. bundle install в / проекта
 4. Перезапустить redmine

## Testing

Creates a test git repository for undev_git
    rake test:scm:setup:undev_git

Prepare test database
    rake RAILS_ENV=test db:drop db:create db:migrate redmine:plugins:migrate

Run tests for redmine_undev_plugin
    rake RAILS_ENV=test NAME=redmine_undev_git redmine:plugins:test


# Версия 2

Плагин UndevGit добавляет в redmine новый тип репозитория UndevGit.
UndevGit умеет делать все то, что делает Git репозиторий, но вдобавок он
добавляет возможность работы с удаленными репозиториями.
Еще, плагин добавляет в редмайн хуки для репозиториев UndevGit.

## Хуки
Назначение хуков - гибко настраивать как и в каких случаях изменять тикет.
Можно настроить выполнение хуков для определенных веток, проекта и даже отдельного репозитория.
Изменения тикета это новое состояние и новый процент выполнения.
Таким образом появляются глобальные хуки которые срабатывают для всех репозиториев,
хуки проекта - которые срабатывают для всех репозиториев проекта и хуки репозитория.
Приоритеты хуков определяются так: наивысший приоритет имеют хуки репозитория,
затем хуки проекта и наменьший приоритет у глобальных хуков.
В случае если для коммита найдено несколько хуков,
выполнен будет только один - с наивысшим приоритетом.
Изменения тикета отражаются в журнале тикета. В случае отсутствия фактических
изменений, когда текущий статус и процент выполнения не изменяются,
запись в журнале тикета не появляется.



[12/29/10 7:19:29 PM] Степанян Аня: ну вот я смотрю в базу нашей инсталляции, и вижу там:

commit_fix_done_ratio 100
commit_fix_keywords fixes,closes
commit_fix_status_id 3
commit_ref_keywords refs,references,IssueID

потому вопросы:
1) как прикрепять тикеты: достаточно ли #123 или нужно писать какие-то ключевые слова?
2) имеют ли силу настройки редмайна, закрывающие тикет и выставляющие ему определённый процент выполнения в сочетании с проектами, в которых дополнительно заданы настройки тикетов по бранчам?
3) имеют ли силу настройки редмайна, закрывающие тикет и выставляющие ему определённый процент выполнения в сочетании с проектами, в которых НЕ заданы настройки тикетов по бранчам?
[12/29/10 7:28:08 PM] Сазанов Дмитрий: 1) да нужно ключевые слова указывать, просто #123 не прикрепляется
2) вот этот момент я похоже упустил. т.е. общие настройки и настройки прожекта независимы. (отсюда предпологаю и двойные смены статусов)
3) если в прожект настройки не заданы, то по ключевым словам тикеты будут работать по старому, т.е н-р закрывать тикет
[12/29/10 7:38:19 PM] Степанян Аня: 1) какие ключевые слова указывать? откуда они берутся — из настроек инсталляции редмайна? если да, то из каких полей? если нет, то просто клёво было бы выдать их (
2) как узнать, какие настройки (проекта или инсталляции) победят? ( видимо, это нужно разруливать. предлагаю также добавить бранч-плагин проценты, аналогично родным редймановским, чтобы они стали совсем взаимозаменяемыми.

[1/12/11 4:04:21 PM] Степанян Аня: а можно попросить тебя написать микро-документацию к плагину?
[1/12/11 4:04:28 PM] Степанян Аня: которая описывает это всё
[1/12/11 4:04:48 PM] Сазанов Дмитрий: ага. конечно. в каком формате ?
[1/12/11 4:10:19 PM] Степанян Аня: 1) поясенние для пользователей на странице настройки соответствия бранчей статусам: что будут использоваться все ключевые слова (как Referencing keywords, так и Fixing keywords) из настроек редмайна, тут же перечислить их из настроек редмайна (в качестве актуальной справочной информации, без возможности редактирования)

2) дока
 • в любом удобном тебе формате прямо в репе плагина: краткое описание структуры проекта, краткое описание того, как он работает
 • можно в рамках предыдущей доки — про то, что приоритет остаётся за настройками плагина, если они не заданы, используются настройки редмайна, что используются все ключевые слова в настройках редмайна, тут же можно написать, где лежат настройки плагина, что они задаются пер проджект в рамках одной инсталляции редмайна, а не для всей инстялляции сразу

аудитория доки:
• разработчик, которому нужно что-то быстро поправить или добавить функционал, не перечитывая весь код проекта
• разворачивающий приложение админ (разработчик?), которому нужно понять, как и где его потом использоваться уже на живом сайтике, и что оно вообще делает

### rebase

В процессе обработки коммита мы определяем повился ли данный коммит вследствии рибейза.
В этом случае мы находим старый коммит и помечаем его как недействительный.
Пометка должна быть видна при просмотре списка коммитов и при просмотре старого коммита со ссылкой на новый.
В новом коммите должна быть ссылка на старый.
